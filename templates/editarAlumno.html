<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Editar alumno</title>
  <link rel="stylesheet" href="/static/css/estilo.css" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- 🟢 Encabezado -->
<nav class="navbar navbar-expand-lg navbar-light bg-light px-4 py-3">
    <img src="{{ url_for('static', filename='img/LOGO UTT.png') }}" alt="Logo UTT" height="150">
    <div class="mx-auto text-center">
        <h4 class="mb-0">Sistema de control y gestión de talleres UTT</h4>
        <small class="text-muted">Universidad Tecnológica de Tlaxcala</small>
    </div>
</nav>
<hr class="linea-negra">
<br>
  <h2 class="titulo-formulario">Editar alumno</h2>
  <form method="POST" enctype="multipart/form-data">
    <div class="form-columns">
      <div class="column">
        <!-- Matrícula -->
        <div class="mb-3">
          <label for="matricula">Matrícula</label>
          <input type="text" id="matricula" name="matricula" value="{{ datos.Matricula }}" readonly />
        </div>

        <!-- Nombre -->
        <div class="mb-3">
          <label for="nombre">Nombre(s)</label>
          <input type="text" id="nombre" name="nombre" value="{{ datos.Nombre }}" required />
        </div>

        <!-- Apellido Paterno -->
        <div class="mb-3">
          <label for="apellido_p">Apellido Paterno</label>
          <input type="text" id="apellido_p" name="apellido_p" value="{{ datos.Apellido_P }}" required />
        </div>

        <!-- Apellido Materno -->
        <div class="mb-3">
          <label for="apellido_m">Apellido Materno</label>
          <input type="text" id="apellido_m" name="apellido_m" value="{{ datos.Apellido_M }}" required />
        </div>

        <!-- Carrera -->
        <div class="mb-3">
          <label for="carrera">Carrera</label>
          <input type="text" id="carrera" name="carrera" value="{{ datos.Carrera }}" required />
        </div>

        <!-- Género -->
        <div class="mb-3">
          <label for="genero">Género</label>
          <select id="genero" name="genero" required>
            <option disabled {% if not datos.Genero %}selected{% endif %}>Selecciona un género</option>
            {% for g in ['H', 'M', 'LGBTQ'] %}
              <option value="{{ g }}" {% if datos.Genero == g %}selected{% endif %}>
                {% if g == 'H' %}Hombre{% elif g == 'M' %}Mujer{% else %}LGBTQ+{% endif %}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Edad -->
        <div class="mb-3">
          <label for="edad">Edad</label>
          <input type="number" id="edad" name="edad" value="{{ datos.Edad }}" required />
        </div>

        <!-- NSS -->
        <div class="mb-3">
          <label for="nss">NSS</label>
          <input type="text" id="nss" name="nss" value="{{ datos.NSS }}" readonly />
        </div>

        <!-- Grado y Grupo -->
        <div class="mb-3">
          <label for="grado_grupo">Grado y Grupo</label>
          <input type="text" id="grado_grupo" name="grado_grupo" value="{{ datos.Grado_Grupo }}" required />
        </div>

        <!-- Teléfono -->
        <div class="mb-3">
          <label for="telefono">Teléfono</label>
          <input type="text" id="telefono" name="telefono" value="{{ datos.Telefono }}" required />
        </div>
      </div>

      <!-- Columna Derecha -->
      <div class="column">
        <!-- Tutor -->
        <div class="mb-3">
          <label for="tutor">Tutor(a)</label>
          <input type="text" id="tutor" name="tutor" value="{{ datos.Tutor }}" required />
        </div>

        <!-- Teléfono Emergencia -->
        <div class="mb-3">
          <label for="telefono_emergencia">Teléfono de Emergencia</label>
          <input type="text" id="telefono_emergencia" name="telefono_emergencia" value="{{ datos.Telefono_Emergencia }}" required />
        </div>

        <!-- Correo -->
        <div class="mb-3">
          <label for="correo">Correo Electrónico</label>
          <input type="email" id="correo" name="correo" value="{{ datos.Correo }}" readonly />
        </div>

        <!-- Taller Inscripción -->
        <div class="mb-3">
          <label for="taller_inscripcion">Taller Inscripción</label>
          <select id="taller_inscripcion" name="taller_inscripcion" required>
            <option value="">Selecciona un taller</option>
            {% for nombre in talleres.keys() %}
              <option value="{{ nombre|lower }}" {% if datos.Taller_Inscripcion == nombre|lower %}selected{% endif %}>
                {{ nombre|capitalize }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Horario -->
        <div class="mb-3">
          <label for="horario">Horario</label>
          <select name="horario" id="horario" required>
            <option value="">Selecciona un horario</option>
          </select>
        </div>


        <!-- Fecha de inscripción -->
        <div class="mb-3">
          <label for="fecha_inscripcion">Fecha de inscripción al taller</label>
          <input type="date" id="fecha_inscripcion" name="fecha_inscripcion"
                value="{{ datos.Fecha_Inscripcion }}" required />
        </div>

        <!-- Imagen de credencial -->
        <div class="mb-3">
          <label for="foto_credencial">Actualizar Foto credencial escolar</label>
          <input type="file" id="foto_credencial" name="foto_credencial" accept="image/*">

          <!-- Mostrar imagen actual -->
          <div class="mb-3" style="text-align: center;">
            <label for="foto_actual" style="display: block; text-align: center;">Foto actual:</label>
            <div style="width: 200px; margin: 0 auto;">
              {% if datos.Foto_Credencial %}
                <img id="foto_actual"
                    src="{{ url_for('static', filename='fotos/' + datos.Foto_Credencial) }}"
                    alt="Foto de credencial"
                    style="width: 100%; height: auto; border: 1px solid #ccc; border-radius: 8px;">
              {% else %}
                <p>No se ha subido ninguna foto aún.</p>
              {% endif %}
            </div>
          </div>

          <!-- Previsualización de la nueva imagen -->
          <div id="previsualizacion" class="mt-2" style="display: none;">
            <p>Previsualización:</p>
            <img id="imagen_previa" src="" alt="Previsualización" style="max-width: 200px;">
          </div>
        </div>
      </div>
    </div>

    <!-- Botón -->
    <div class="button-container">
      <button type="submit" class="btn">Guardar cambios</button>
    </div>
  </form>

  <!-- Scripts -->
  <script>
    function mostrarImagen(event) {
      const archivo = event.target.files[0];
      const reader = new FileReader();

      reader.onload = function(e) {
        document.getElementById('imagen_previa').src = e.target.result;
        document.getElementById('previsualizacion').style.display = 'block';
      }

      if (archivo) {
        reader.readAsDataURL(archivo);
      }
    }

    document.getElementById("foto_credencial").addEventListener("change", mostrarImagen);
  </script>

  {% if talleres %}
  <script>
    const talleres = {{ talleres | tojson | safe }};

    function actualizarHorarios() {
      const tallerSelect = document.getElementById("taller_inscripcion");
      const horarioSelect = document.getElementById("horario");
      const tallerSeleccionado = tallerSelect.value.toLowerCase();

      horarioSelect.innerHTML = "";

      if (tallerSeleccionado && talleres[tallerSeleccionado]) {
        const horarios = talleres[tallerSeleccionado];
        if (horarios.length > 0) {
          const opciones = horarios.map(h => `<option value="${h}">${h}</option>`);
          horarioSelect.innerHTML = opciones.join("");

          const horarioActual = "{{ datos.Horario }}";
          for (const option of horarioSelect.options) {
            if (option.value === horarioActual) {
              option.selected = true;
              break;
            }
          }
        } else {
          horarioSelect.innerHTML = '<option value="">No hay horarios disponibles</option>';
        }
      } else {
        horarioSelect.innerHTML = '<option value="">Selecciona un horario</option>';
      }
    }

    document.addEventListener("DOMContentLoaded", actualizarHorarios);
    document.getElementById("taller_inscripcion").addEventListener("change", actualizarHorarios);
  </script>
  {% endif %}
  <!-- 🟢 Pie de página -->
<footer class="footer-personalizado text-white text-center mt-5 py-4">
    <div class="container container-footer">
        <div class="row mb-3">
            <div class="col-md-4">
                <p><strong>Comunícate:</strong></p>
                <p>contacto@uttlaxcala.edu.mx</p>
                <p>(247) 47-25-300</p>
                <div>
                    <a href="https://www.facebook.com/share/1ZRmk4uYoG/"><img class="icono-footer" src="{{ url_for('static', filename='img/facebook.png') }}" width="24"></a>
                    <a href="https://www.instagram.com/ut_tlaxcala?igsh=MWNpMjgyNmxvcjNodA=="><img class="icono-footer" src="{{ url_for('static', filename='img/logotipo-de-instagram.png') }}" width="24"></a>
                    <a href="https://chat.whatsapp.com/IuDjMt9CBicDloHkIPTy5F"><img class="icono-footer" src="{{ url_for('static', filename='img/whatsapp.png') }}" width="24"></a>
                </div>
            </div>
            <div class="col-md-4">
                <p><strong>Horario de atención:</strong></p>
                <p>Lunes a Viernes</p>
                <p>09:00 - 17:00 hrs</p>
            </div>
            <div class="col-md-4">
                <p><strong>Ubicación:</strong></p>
                <a href="https://maps.app.goo.gl/Uj8eRuzkXFUboarS7">
        <img src="static/img/mapa.png" alt="Mapa de ubicacion" width="200" height="100"></a>
        </div>
        <p class="texto-copy mt-3 mb-0">© 2025 Taller UTT - Todos los derechos reservados</p>
    </div>
</footer>
</body>
</html>