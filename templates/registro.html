<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro Alumno</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo.css') }}">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" rel="stylesheet">
</head>
<body>
  <!--  Encabezado -->
<header class="mi-header">
    <img src="{{ url_for('static', filename='img/LOGO UTT.png') }}" alt="Logo UTT" height="150">
    <div>
      <center><h1>Sistema de control y gesti贸n de talleres UTT</h1></center>
      <center><p>Universidad Tecnol贸gica de Tlaxcala</p></center>
    </div>
  </header>
<hr class="linea-negra">
<br>
  <h2 class="titulo-formulario">Registro alumno</h2>
  <form action="/registro" method="POST" enctype="multipart/form-data">
    <div class="form-columns">
      <div class="column">
        <div class="mb-3">
          <label for="matricula">Matr铆cula</label>
          <input type="text" id="matricula" name="matricula"
              class="{% if 'matricula' in errors %}input-error{% endif %}"
              value="{{ form_data.get('matricula', '') }}" required>
          {% if 'matricula' in errors %}
              <div class="error-message">{{ errors['matricula'] }}</div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label for="nombre">Nombre(s)</label>
          <input type="text" id="nombre" name="nombre" value="{{ request.form.get('nombre', '') }}" class="{% if error_field == 'nombre' %}input-error{% endif %}" required>
          {% if error_field == 'nombre' %}<div class="error-message">{{ error }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label for="apellido_p">Apellido Paterno</label>
          <input type="text" id="apellido_p" name="apellido_p" value="{{ request.form.get('apellido_p', '') }}" required>
        </div>
        <div class="mb-3">
          <label for="apellido_m">Apellido Materno</label>
          <input type="text" id="apellido_m" name="apellido_m" value="{{ request.form.get('apellido_m', '') }}" required>
        </div>
        <div class="mb-3">
          <label for="carrera">Carrera</label>
          <input type="text" id="carrera" name="carrera" value="{{ request.form.get('carrera', '') }}" required>
        </div>
        <div class="mb-3">
          <label for="genero">G茅nero</label>
          <select id="genero" name="genero" required>
            <option value="">Selecciona un g茅nero</option>
            <option value="H" {% if request.form.get('genero') == 'H' %}selected{% endif %}>Hombre</option>
            <option value="M" {% if request.form.get('genero') == 'M' %}selected{% endif %}>Mujer</option>
            <option value="LGBTQ" {% if request.form.get('genero') == 'LGBTQ' %}selected{% endif %}>LGBTQ+</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="edad">Edad</label>
          <input type="number" id="edad" name="edad" value="{{ request.form.get('edad', '') }}" required>
        </div>
        <div class="mb-3">
                <label for="nss">NSS</label>
                <input type="text" id="nss" name="nss"
                    class="{% if 'nss' in errors %}input-error{% endif %}"
                    value="{{ form_data.get('nss', '') }}" required>
                {% if 'nss' in errors %}
                    <div class="error-message">{{ errors['nss'] }}</div>
                {% endif %}
          </div>
        <div class="mb-3">
          <label for="grado_grupo">Grado y Grupo</label>
          <input type="text" id="grado_grupo" name="grado_grupo" value="{{ request.form.get('grado_grupo', '') }}" required>
        </div>
        <div class="mb-3">
          <label for="telefono">Tel茅fono</label>
          <input type="text" id="telefono" name="telefono" value="{{ request.form.get('telefono', '') }}" required>
        </div>
      </div>

      <div class="column">
        <div class="mb-3">
          <label for="tutor">Tutor(a)</label>
          <input type="text" id="tutor" name="tutor" value="{{ request.form.get('tutor', '') }}" required>
        </div>
        <div class="mb-3">
          <label for="telefono_emergencia">Tel茅fono Emergencia</label>
          <input type="text" id="telefono_emergencia" name="telefono_emergencia" value="{{ request.form.get('telefono_emergencia', '') }}" required>
        </div>
        <div class="mb-3">
                <label for="correo">Correo Electr贸nico</label>
                <input type="email" id="correo" name="correo"
                    class="{% if 'correo' in errors %}input-error{% endif %}"
                    value="{{ form_data.get('correo', '') }}" required>
                {% if 'correo' in errors %}
                    <div class="error-message">{{ errors['correo'] }}</div>
                {% endif %}
        </div>
        <!-- Taller y horario -->
        <div class="mb-3">
          <label for="taller_inscripcion">Taller Inscrito</label>
          <select id="taller_inscripcion" name="taller_inscripcion" required onchange="actualizarHorarios()">
            <option value="">Selecciona un taller</option>
            {% for nombre in talleres.keys() %}
              <option value="{{ nombre }}" {% if form_data.Taller_Inscripcion == nombre %}selected{% endif %}>{{ nombre }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label for="horario">Horario Disponible</label>
          <select id="horario" name="horario" required>
            {% if form_data.horario %}
              <option selected>{{ form_data.horario }}</option>
            {% else %}
              <option value="">Selecciona un horario</option>
            {% endif %}
          </select>
        </div>
        <div class="mb-3">
          <label for="fecha_inscripcion">Fecha de inscripci贸n al taller</label>
          <input type="date" id="fecha_inscripcion" name="fecha_inscripcion" value="{{ form_data.get('fecha_inscripcion', '') }}" required>
        </div>
        <div class="mb-3">
          <label for="contrasena">Contrase帽a</label>
          <input type="password" id="contrasena" name="contrasena" required>
        </div>
        <div class="mb-3">
          <label for="confirmar">Confirmar Contrase帽a</label>
          <input type="password" id="confirmar" name="confirmar" required>
        </div>
        <div class="mb-3" style="text-align: center;">
          <label for="foto_credencial">Foto credencial escolar</label>
          <input type="file" id="foto_credencial" name="foto_credencial" accept="image/*" style="display: none;">
          <label for="foto_credencial" class="foto-btn">
            <span class="plus-icon">+</span>
          </label>
        </div>
        <div class="mb-3" style="text-align: center;">
          <label for="nota_importante">Nota: El usuario para iniciar sesi贸n <br> utilizar谩 la matr铆cula,<br> verificar que sea correcta.</label>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button type="submit" class="btn">Guardar registro</button>
    </div>
  </form>

{% if talleres %}
<script>
  const talleres = {{ talleres | tojson | safe }};

  function actualizarHorarios() {
    const tallerSelect = document.getElementById("taller_inscripcion");
    const horarioSelect = document.getElementById("horario");
    const tallerSeleccionado = tallerSelect.value;

    horarioSelect.innerHTML = "";

    if (tallerSeleccionado && talleres[tallerSeleccionado]) {
      const horarios = talleres[tallerSeleccionado];
      const opciones = Object.entries(horarios).map(([dia, rango]) => {
        return `<option value="${dia}: ${rango}">${dia}: ${rango}</option>`;
      });
      horarioSelect.innerHTML = opciones.join("");
    } else {
      horarioSelect.innerHTML = '<option value="">Selecciona un horario</option>';
    }
  }

  document.addEventListener("DOMContentLoaded", actualizarHorarios);
</script>
{% endif %}

{% if session.get("registro_error") %}
<div id="custom-alert" class="custom-alert error">
  <div class="custom-alert-content">
    <span class="close-btn" onclick="cerrarAlerta()"></span>
    <h3>Advertencia</h3>
    <p>Error al registrar el alumno</p>
  </div>
</div>
<script>
  function cerrarAlerta() {
    document.getElementById("custom-alert").style.display = "none";
  }
  setTimeout(cerrarAlerta, 4000);
</script>
{% set _ = session.pop("registro_error") %}
{% endif %}
<!--  Pie de p谩gina -->
<footer class="footer-personalizado text-white mt-5">
  <div class="container container-footer">
    <div class="row justify-content-between align-items-start">

      <!-- Columna 1: Contacto -->
      <div class="col-md-4 footer-col">
        <p><strong>Comun铆cate:</strong></p>
        <p>contacto@uttlaxcala.edu.mx</p>
        <p>(247) 47-25-300</p>
        <div class="social-icons mt-2">
  <a href="https://www.facebook.com/share/1ZRmk4uYoG/">
    <img class="icono-footer" src="{{ url_for('static', filename='img/facebook.png') }}" alt="Facebook" />
  </a>
  <a href="https://www.instagram.com/ut_tlaxcala?igsh=MWNpMjgyNmxvcjNodA==">
    <img class="icono-footer" src="{{ url_for('static', filename='img/logotipo-de-instagram.png') }}" alt="Instagram" />
  </a>
  <a href="https://chat.whatsapp.com/IuDjMt9CBicDloHkIPTy5F">
    <img class="icono-footer" src="{{ url_for('static', filename='img/whatsapp.png') }}" alt="WhatsApp" />
  </a>
      </div>
      </div>

      <!-- Columna 2: Horario -->
      <div class="col-md-4 footer-col">
        <p><strong>Horario de atenci贸n:</strong></p>
        <p>Lunes a Viernes</p>
        <p>09:00 - 17:00 hrs</p>
      </div>

      <!-- Columna 3: Ubicaci贸n -->
      <div class="col-md-4 footer-col">
        <p><strong>Ubicaci贸n:</strong></p>
        <a href="https://maps.app.goo.gl/Uj8eRuzkXFUboarS7">
          <img class="mapa-footer" src="{{ url_for('static', filename='img/mapa.png') }}" alt="Mapa de ubicaci贸n" />
        </a>
      </div>

    </div>

    <div class="text-center mt-4">
      <p class="texto-copy mb-0">漏 2025 Taller UTT - Todos los derechos reservados</p>
    </div>
  </div>
</footer>
</body>
</html>
